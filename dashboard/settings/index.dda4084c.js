var e={buildButton:function(e,n,t){const o=document.createElement("button");return t&&t.length>0&&o.classList.add(...t),o.name=e,o.innerText=n,o},buildLabel:function(e,n,t){const o=document.createElement("label");return t&&t.length>0&&o.classList.add(...t),o.htmlFor=e,o.innerText=n,o},buildTextInput:function(e,n,t){const o=document.createElement("input");return t&&t.length>0&&o.classList.add(...t),o.type="text",o.name=e,o.value=n,o},buildSelect:function(e,n,t){const o=document.createElement("select");return e&&e.length>0&&o.classList.add(...e),o.name=n,t.forEach((e=>{const n=document.createElement("option");n.value=e.value,n.innerText=e.label,n.selected=e.selected,o.add(n)})),o},buildHiddenInput:function(e,n){const t=document.createElement("input");return t.type="hidden",t.name=e,t.value=n,t},buildSpan:function(e,n){const t=document.createElement("span");return n&&n.length>0&&t.classList.add(...n),t.innerText=e,t},buildDiv:function(e,n){const t=document.createElement("div");return n&&n.length>0&&t.classList.add(...n),e&&(t.id=e),t},buildNumberInput:function(e,n,t){const o=document.createElement("input");return t&&t.length>0&&o.classList.add(...t),o.type="number",o.name=e,o.value=n,o},buildForm:function(e,n,t){const o=document.createElement("form");return e&&(o.name=e),n&&(o.id=n),t&&t.length>0&&o.classList.add(...t),o}};let n;var t;let o;(t=n||(n={})).soundCueConfig="soundCueConfig",t.soundCuesEnabled="soundCuesEnabled",t.soundCueList="soundCueList",t.soundCueLog="soundCueLog",t.soundCueTypes="soundCueTypes",t.soundCueCommandIndex="soundCueCommandIndex",t.nodeCGServerSoundCues="soundCues",(o||(o={})).change="change";var a=o;let d;var l;let i;(l=d||(d={})).commandFormRow="commandFormRow",l.btnRemove="btnRemove",l.btnAdd="btnAdd",l.formGroup="formGroup",l.middle="middle",l.btnToggleEnabled="btnToggleEnabled",l.enabled="enabled",l.readOnly="readOnly",l.hidden="hidden",l.cueSelectWrapper="cueSelectWrapper",(i||(i={})).cueConfigPanel="cueConfigPanel";const r=nodecg.Replicant(n.soundCueConfig),c=nodecg.Replicant(n.soundCueTypes),u=nodecg.Replicant(n.soundCueList);function s(e){if(!r||!r.value)throw Error("Unable to retrieve command config - config replicant not available.");const n=r.value.find((n=>n.id===e));if(!n)throw Error(`Unable to find command with ID ${e}.`);return{...n}}function m(e){if(!c||!c.value)throw Error("Unable to retrieve command types.");return c.value.reduce(((n,t)=>(n.push({label:t,value:t,selected:e===t}),n)),[{label:"Select one",value:"-1",selected:!e}])}function p(e){if(!u||!u.value)throw Error("Sound cue replicant not available.");const n=u.value,t=e.map((e=>function(e,n){let t;if(n)t=n;else{if(!u||!u.value)throw Error("Sound cue replicant not available.");t=u.value}return t.reduce(((n,t)=>(n.push({label:t,value:t,selected:e===t}),n)),[{label:"Select one",value:"-1",selected:!e}])}(e,n)));return t}function f(e){if(e.preventDefault(),!r||!r.value)return void console.error("Failed enabling/disabling sound alert - replicant not available.");if(!e.target)return void console.error("Failed enabling/disabling sound alert - no event target found.");const n=e.target;if(!n.dataset.cmdName)return void console.error("Failed enabling/disabling sound alert - command name found.");const t=n.dataset.cmdName,o=r.value.find((e=>e.commandName===t));if(!o)return void console.error(`Failed enabling/disabling sound alert - command matching "${t}" not found.`);const a="true"===n.dataset.enabled;o.enabled=!a}function b(e){const n=e.querySelectorAll(".fieldValue");if(n&&n.length>0)for(let t=0;t<n.length;t++){const o=n[t];e.removeChild(o)}}function g(n){if(n.preventDefault(),!n.target)return void console.error("Failed sound alert edit - no event target found.");const t=n.target.closest("form");if(!t)return void console.error("Failed sound alert edit - unable to locate form.");const o=t.dataset.id?parseInt(t.dataset.id):-1;if(o<0)return void console.error("Failed sound alert edit - no ID found.");const a=t.querySelectorAll("div.formGroup");if(a.length<=0)return void console.error("Failed sound alert edit - unable to locate form groups.");const d=s(o),l=["fieldValue"];for(let n=0;n<a.length;n++){const t=a[n];switch(t.dataset.fieldName){case"name":const n=e.buildSpan(d.commandName,l);b(t),t.appendChild(n);break;case"cooldown":const o=d.coolDownMs?d.coolDownMs.toString():"0",a=e.buildSpan(o,l);b(t),t.appendChild(a);break;case"type":const i=e.buildSpan(d.commandType,l);b(t),t.appendChild(i);break;case"cues":const r=e.buildSpan(d.mappedCues.join(", "),l);b(t),t.append(r);break;case"edit":const c=e.buildButton("btnEdit","Edit",[]);c.onclick=v,t.replaceChildren(c)}}t.dataset.editing="false"}function v(n){if(n.preventDefault(),!n.target)return void console.error("Failed sound alert edit - no event target found.");const t=n.target.closest("form");if(!t)return void console.error("Failed sound alert edit - unable to locate form.");t.dataset.editing="true";const o=t.dataset.id?parseInt(t.dataset.id):-1;if(o<0)return void console.error("Failed sound alert edit - no ID found.");const a=t.querySelectorAll("div.formGroup");if(a.length<=0)return void console.error("Failed sound alert edit - unable to locate form groups.");const l=s(o),i=["fieldValue"];for(let n=0;n<a.length;n++){const t=a[n];switch(t.dataset.fieldName){case"name":const n=e.buildTextInput("commandName",l.commandName,i);b(t),t.appendChild(n);break;case"cooldown":const o=l.coolDownMs?l.coolDownMs.toString():"0",a=e.buildNumberInput("cooldownMs",o,i);b(t),t.appendChild(a);break;case"type":const r=m(l.commandType),c=e.buildSelect(i,"commandType",r);b(t),t.appendChild(c);break;case"cues":const u=p(l.mappedCues).map((n=>e.buildSelect(i,"mappedCues",n)));b(t),t.append(...u);break;case"edit":const s=e.buildButton("btnSave","Save",[d.btnAdd]),f=e.buildButton("btnCancel","Cancel",[]);f.onclick=g;const v=e.buildButton("btnDelete","Delete",[d.btnRemove]);t.replaceChildren(s,f,v)}}}function C(n){let t=[d.formGroup];n&&(t=t.concat(n));return e.buildDiv(void 0,t)}function h(n,t,o,a){const d=C();d.dataset.fieldName=n;let l=e.buildLabel(t,o);const i=e.buildSpan(a,["fieldValue"]);return d.append(l,i),d}function y(n,t){if(!c||!c.value)throw Error("Unable to map command rows - no command types are loaded.");if(!u||!u.value)throw Error("Unable to map command rows - no sound cues are loaded.");console.log(JSON.stringify(n));const o=e.buildForm(`commandForm-${n.id}`,null,[]);o.dataset.id=n.id.toString(),o.dataset.commandName=n.commandName,o.dataset.index=t.toString(),o.dataset.editing="false";const a=e.buildDiv(`cmd-row-${n.commandName}`,[d.commandFormRow]);let l=C([d.middle]);l.dataset.fieldName="enabled";let i=function(n,t){let o=n?"On":"Off";const a=e.buildButton("btnEnabled",o,[d.btnToggleEnabled]);return n&&a.classList.add(d.enabled),a.onclick=f,a.dataset.cmdName=t,a.dataset.enabled=n.toString(),a}(n.enabled,n.commandName);l.appendChild(i),a.appendChild(l),l=C([d.middle]),l.dataset.fieldName="id";let r=e.buildSpan(n.id.toString());l.appendChild(r),a.appendChild(l),l=h("name","commandName","Name",n.commandName),a.appendChild(l),l=h("cooldown","coolDownMs","Cooldown",n.coolDownMs?`${n.coolDownMs} ms`:"None"),a.appendChild(l),l=h("type","commandType","Type",n.commandType),a.appendChild(l);return l=h("cues","mappedCues","Cues",n.mappedCues.length<=0?"None":n.mappedCues.join(", ")),a.appendChild(l),l=C([d.middle]),l.dataset.fieldName="edit",i=e.buildButton("","Edit",[]),i.onclick=v,l.appendChild(i),a.appendChild(l),o.appendChild(a),o}function S(e,n){const t=e.querySelector(".fieldValue");t&&("span"===t.tagName?t.innerText=n:("input"===t.tagName||"select"===t.tagName)&&(t.value=n))}function w(n,t){Array.isArray(n)?n&&!t?function(e){const n=document.getElementById(i.cueConfigPanel);if(!n)return void console.error("Unable to locate panel, skipping form initialization.");const t=e.map(y);n.append(...t)}(n):n&&t?function(n,t){const o=document.getElementById(i.cueConfigPanel);if(!o)return void console.error("Unable to locate panel, skipping form update.");const a=[];for(let l=0;l<n.length;l++){const i=n[l];a.push(i.id);let r=!1;const c=l<t.length?t[l]:null,u=document.querySelector(`form[data-id='${i.id}']`);if(c){if(c.allCuesAreValid!==i.allCuesAreValid&&(r=!0),c.lastUseTimestamp!==i.lastUseTimestamp&&(r=!0),c.commandName!==i.commandName){r=!0;const e=u.querySelector("div.formGroup[data-field-name='name']");e&&S(e,i.commandName)}if(c.commandType!==i.commandType){r=!0;const e=u.querySelector("div.formGroup[data-field-name='type']");e&&S(e,i.commandType)}if(c.commandUsageCount!==i.commandUsageCount&&(r=!0),c.coolDownMs!==i.coolDownMs){r=!0;const e=u.querySelector("div.formGroup[data-field-name='cooldown']");e&&S(e,i.coolDownMs?i.coolDownMs.toString():"0")}if(c.enabled!==i.enabled){r=!0;const e=u.querySelector("div.formGroup[data-field-name='enabled']");if(e){const n=e.querySelector("button");n.dataset.enabled=i.enabled.toString(),i.enabled?(n.innerText="On",n.classList.add(d.enabled)):(n.innerText="Off",n.classList.remove(d.enabled))}}c.orderedMappingIndex!==i.orderedMappingIndex&&(r=!0),c.id!==i.id&&(r=!0);const n=c.mappedCues,t=i.mappedCues;if(n.length!==t.length||!t.every(((e,t)=>e===n[t]))){r=!0;const n=u.querySelector("div.formGroup[data-field-name='cues']");if(u.dataset.editing){const o=p(t).map((n=>e.buildSelect(["fieldValue"],"mappedCues",n)));b(n),n.append(...o)}else n&&S(n,t.join(", "))}}else{const e=y(i,l);o.append(e)}}}(n,t):!n&&t&&(document.getElementById(i.cueConfigPanel)||console.error("Unable to locate panel, skipping form teardown.")):console.error("No config was provided, skipping form render.")}document.addEventListener("DOMContentLoaded",(function(){NodeCG.waitForReplicants(r,c,u).then((()=>{r.on(a.change,w)}))}));
//# sourceMappingURL=index.dda4084c.js.map
